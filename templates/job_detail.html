{% extends "base.html" %}
{% block content %}
<div class="flex justify-between items-center mb-4">
  <div>
    <h1 class="text-2xl font-semibold">{{ job.title }}</h1>
    <p class="text-gray-500">{{ job.description }}</p>
  </div>
  <a href="/jobs/{{ job.id }}/export.csv" class="bg-indigo-600 text-white px-4 py-2 rounded">Export CSV</a>
</div>

<form action="/jobs/{{ job.id }}/resumes/upload" method="post" enctype="multipart/form-data" class="bg-white p-4 rounded shadow mb-6">
  <label class="block mb-2 font-medium">Загрузить резюме (.pdf/.docx/.txt, до 5MB)</label>
  <input class="border p-2 w-full mb-3" type="file" name="files" multiple required>
  <button class="bg-green-600 text-white px-4 py-2 rounded">Upload + Analyze</button>
</form>

<div class="bg-white rounded shadow overflow-hidden">
  <table class="w-full text-sm">
    <thead class="bg-gray-50">
      <tr>
        <th class="p-3 text-left">Resume</th>
        <th class="p-3 text-left">Status</th>
        <th class="p-3 text-left">Total</th>
        <th class="p-3 text-left">Hard</th>
        <th class="p-3 text-left">Soft</th>
        <th class="p-3 text-left">Sanity</th>
        <th class="p-3 text-left">Label</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr class="border-t align-top">
        <td class="p-3">
          <details>
            <summary class="cursor-pointer text-blue-600">{{ row.resume.filename }}</summary>
            <div class="mt-2 text-xs bg-gray-50 p-2 rounded space-y-2">
              <div><strong>Hard:</strong> {{ row.details.get('hard', {}) }}</div>
              <div><strong>Soft:</strong> {{ row.details.get('soft', {}) }}</div>
              <div><strong>Sanity:</strong> {{ row.details.get('sanity', {}) }}</div>
              <div><strong>Penalties:</strong> {{ row.details.get('penalties', []) }}</div>
            </div>
          </details>
        </td>
        <td class="p-3">{{ row.analysis.status }}</td>
        <td class="p-3">{{ row.analysis.score_total }}</td>
        <td class="p-3">{{ row.analysis.score_hard }}</td>
        <td class="p-3">{{ row.analysis.score_soft }}</td>
        <td class="p-3">{{ row.analysis.score_sanity }}</td>
        <td class="p-3">
          {% if row.analysis.label == 'green' %}
          <span class="px-2 py-1 rounded bg-green-100 text-green-800">green</span>
          {% elif row.analysis.label == 'yellow' %}
          <span class="px-2 py-1 rounded bg-yellow-100 text-yellow-800">yellow</span>
          {% else %}
          <span class="px-2 py-1 rounded bg-red-100 text-red-800">red</span>
          {% endif %}
        </td>
      </tr>
      {% else %}
      <tr><td class="p-3" colspan="7">Резюме еще не загружены</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
